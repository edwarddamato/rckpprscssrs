Element.prototype.addClass=function(a){for(var b=this,c=b.hasAttribute("class")?b.getAttribute("class").split(" "):[],d=a.split(" "),e=0;e<d.length;e++){var f=d[e];c.indexOf(f)<0&&c.push(f)}b.setAttribute("class",c.join(" "))},Element.prototype.removeClass=function(a){for(var b=this,c=b.hasAttribute("class")?b.getAttribute("class").split(" "):[],d=[],e=a.split(" "),f=0;f<c.length;f++){var g=c[f];e.indexOf(g)<0&&d.push(g)}b.setAttribute("class",d.join(" "))},NodeList.prototype.removeClass=function(a){for(var b=this,c=0;c<b.length;c++){var d=b[c];1===d.nodeType&&d.removeClass(a)}},NodeList.prototype.addEvent=function(a,b){for(var c=this,d=0;d<c.length;d++)c[d].addEventListener(a,function(a){b(this,a)})},Element.prototype.empty=function(){for(var a=this;a.firstChild;)a.removeChild(a.firstChild)},Array.prototype.getRandomValue=function(){return this[Math.floor(Math.random()*(this.length-1+1)+1)-1]};var Game=function(){var a={},b={},c={HUMAN:0,COMPUTER:1},d={subscribers:[],subscribe:function(a){d.subscribers.push(a)},updateSubscribers:function(){for(var a=0;a<d.subscribers.length;a++)d.subscribers[a]()},start:function(b,e){a.winner=-1,a.gameOver=!1,a.turn=0,a.players=[{type:b,score:{wins:0,losses:0,draws:0},move:-1,name:""},{type:e,score:{wins:0,losses:0,draws:0},move:-1,name:""}],a.players[0].name=a.players[0].type===c.COMPUTER?"COMPUTER 1":"HUMAN 1",a.players[1].name=a.players[1].type===c.COMPUTER?"COMPUTER 2":"HUMAN 2",d.updateSubscribers(),d.waitForTurn()},finish:function(){a.players=[],d.updateSubscribers()},"continue":function(){a.gameOver=!1,a.turn=0,a.winner=-1,a.players[0].move=-1,a.players[1].move=-1,d.updateSubscribers(),d.waitForTurn()},play:function(a,b){a.move=b,Storage.storeMove(a,b),d.waitForTurn(),d.updateSubscribers()},generateMove:function(a,d){clearTimeout(b),b=window.setTimeout(function(){if(a.type===c.HUMAN){var b=Storage.getMoves(a);if(b.length<2)d(Moves.getRandomMove());else{b.splice(-1,1);var e=Moves.guessNextMove(b.reverse());d(e.length>0?Moves.getMoveBeatsMove(e):Moves.getRandomMove())}}else d(Moves.getRandomMove())},2e3)},waitForTurn:function(){a.gameOver=!1;var b=a.players[0],e=a.players[1];if(-1===b.move){if(a.turn=0,b.type===c.HUMAN)return;if(b.type===c.COMPUTER)return void d.generateMove(e,function(a){d.play(b,a)})}if(-1===e.move){if(a.turn=1,e.type===c.HUMAN)return;if(e.type===c.COMPUTER)return void d.generateMove(b,function(a){d.play(e,a)})}if(-1!==b.move&&-2!==e.move){if(b.move===e.move)a.winner=-1,b.score.draws++,e.score.draws++;else{var f=Moves.getWinner(b.move,e.move);b.move===f?d.setRoundResults(b,e):d.setRoundResults(e,b)}a.gameOver=!0,d.updateSubscribers()}},setRoundResults:function(b,c){b.score.wins++,c.score.losses++,a.winner=b}};return{PLAYERS:c,current:a,start:d.start,finish:d.finish,play:d.play,"continue":d["continue"],waitForTurn:d.waitForTurn,subscribe:d.subscribe}}(),Moves=function(){var a={ROCK:"ROCK",PAPER:"PAPER",SCISSORS:"SCISSORS",LIZARD:"LIZARD",SPOCK:"SPOCK"},b={ROCK:{beats:[a.SCISSORS,a.LIZARD]},PAPER:{beats:[a.ROCK,a.SPOCK]},SCISSORS:{beats:[a.PAPER,a.LIZARD]},LIZARD:{beats:[a.SPOCK,a.PAPER]},SPOCK:{beats:[a.ROCK,a.SCISSORS]}},c={getWinner:function(a,c){return b[a].beats.indexOf(c)>-1?a:c},getMoveBeatsMove:function(a){var c=[];for(var d in b)b.hasOwnProperty(d)&&b[d].beats.indexOf(a)>-1&&c.push(d);return c.getRandomValue()},getMovesList:function(){var b=[],c=a;for(var d in c)c.hasOwnProperty(d)&&b.push(c[d]);return b},getRandomMove:function(){return c.getMovesList().getRandomValue()},guessNextMove:function(a){for(var b="",c=a.slice(0,Math.ceil(a.length/2)),d=a.join(","),e=!1;!e;){var f=c.join(","),g=d.indexOf(f,1);if(g>0){var h=d.substr(0,g-1).split(",");b=h[h.length-1],e=!0}else{if(!(c.length>1))break;c.splice(-1,1)}}return b}};return{getMovesList:c.getMovesList,getRandomMove:c.getRandomMove,getWinner:c.getWinner,guessNextMove:c.guessNextMove,getMoveBeatsMove:c.getMoveBeatsMove,MOVES:a}}(),Storage=function(){var a={},b={storeMove:function(b,c){"undefined"!=typeof Storage&&(sessionStorage.playHistory&&(a=JSON.parse(sessionStorage.playHistory)),("undefined"==typeof a[b.name]||a[b.name].length<1)&&(a[b.name]=new Array),a[b.name].push(c),sessionStorage.playHistory=JSON.stringify(a))},getMoves:function(b){return"undefined"!=typeof Storage?(sessionStorage.playHistory&&(a=JSON.parse(sessionStorage.playHistory)),"undefined"!=typeof a[b.name]?a[b.name]:[]):void 0}};return{storeMove:b.storeMove,getMoves:b.getMoves}}(),UI=function(){var a=[],b=[],c=null,d={setUI:function(){b=Moves.getMovesList(),d.bindEvents(),Game.subscribe(e.refresh)},bindEvents:function(){a=document.querySelectorAll(".js_nav-game-start");for(var b=0;b<a.length;b++){var c=a[b];c.addEventListener("click",function(){var b=this;a.removeClass("st-active"),b.addClass("st-active");var c=JSON.parse(b.getAttribute("data-players"));Game.start(c.p1,c.p2)})}var e=document.querySelectorAll(".js_game-stop");e.addEvent("click",function(a,b){b.stopPropagation(),d.finishGame()});var f=document.querySelector(".js_button-again");f.addEventListener("click",function(){Game["continue"]()})},finishGame:function(){a.removeClass("st-active"),Game.finish()}},e={getMoveIcon:function(a){var b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.addClass("icon icon_play icon_play--"+a.toLowerCase());var c=document.createElementNS("http://www.w3.org/2000/svg","use");return c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#icon-"+a.toLowerCase()),b.appendChild(c),b},getBoardForPlayer:function(a,d){var f=document.createElement("li");f.addClass("session_board-item"),a.type===Game.PLAYERS.COMPUTER&&f.addClass("session_board-item--c");var g=document.createElement("ul");g.addClass("session_moves-list"),-1!==a.move?g.addClass("st-done"):d||g.addClass("st-waiting");for(var h=0;h<b.length;h++)!function(){var d=b[h],f=document.createElement("li");f.addClass("session_moves-item"),a.move===d&&f.addClass("st-selected"),f.appendChild(e.getMoveIcon(d)),a.type===Game.PLAYERS.HUMAN&&f.addEventListener("click",function(){window.clearTimeout(c),c=window.setTimeout(function(){Game.play(a,d)},100)},!1);var i=document.createElement("span");i.addClass("session_moves-title"),i.innerText=d,f.appendChild(i),g.appendChild(f)}();return f.appendChild(g),f},generateSession:function(){var a=Game.current,b=a.players,c=document.querySelector(".js_game-players");c.empty();var d=document.querySelectorAll(".js_leaderboard-player"),f=document.querySelectorAll(".js_leaderboard-player-stats"),g=document.querySelector(".js_game-scores");g.empty();var h=document.querySelector(".js_session_board-list");h.empty();for(var i=0;i<b.length;i++){var j=b[i];d[i].innerText=j.name,e.setPlayerLeaderboard(f[i],j);var k=document.createElement("li");k.addClass("session_players-item"),k.innerText=j.name,c.appendChild(k);var l=document.createElement("span");l.addClass("session_players-turn"),l.innerText="Your Turn",k.appendChild(l),a.turn===i&&k.addClass("st-hasturn");var m=document.createElement("li");m.addClass("session_scores-item"),m.innerText=j.score.wins,g.appendChild(m),h.appendChild(e.getBoardForPlayer(j,a.turn===i))}if(a.gameOver){var n=document.querySelector(".js_session-winner"),o=document.querySelector(".js_session-moves"),p=document.querySelector(".js_session_description");if(o.empty(),-1===a.winner)n.innerText="That was a draw!",p.innerText="Both players played "+a.players[0].move;else{n.innerText=a.winner.name+" wins",p.innerText=a.winner.move+" beats";for(var i=0;i<a.players.length;i++){var j=a.players[i],q=e.getMoveIcon(j.move);j.move===a.winner.move?q.addClass("st-winner"):p.innerText+=" "+j.move,o.appendChild(q)}}}},setPlayerLeaderboard:function(a,b){a.empty(),a.appendChild(e.generateStat("Victories",b.score.wins)),a.appendChild(e.generateStat("Defeats",b.score.losses)),a.appendChild(e.generateStat("Draws",b.score.draws))},generateStat:function(a,b){var c=document.createElement("li");return c.addClass("leaderboard_player-stat"),c.innerHTML='<div class="leaderboard_player-label">'+a+'</div><div class="leaderboard_player-value">'+b+"</div>",c},refresh:function(){var a=document.querySelector(".js_session"),b=document.querySelector(".js-session-action-list"),c=Game.current;c.players.length>0?(a.addClass("st-active"),b.addClass("st-active"),c.gameOver?a.addClass("st-gameover"):a.removeClass("st-gameover"),e.generateSession()):(a.removeClass("st-active"),b.removeClass("st-active"))}};return{start:d.setUI}}(),Main=function(){UI.start()}();